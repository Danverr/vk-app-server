# Содержание
* **statAccess**
   * [GET /statAccess/](#get-stataccess)
   * [POST /statAccess/](#post-stataccess)
   * [DELETE /statAccess/](#delete-stataccess)
* **entries**
   * [GET /entries/](#get-entries)
   * [GET /entries/stats](#get-entriesstats)
   * [POST /entries/](#post-entries)
   * [PUT /entries/](#put-entries)    
   * [DELETE /entries/](#delete-entries)
* **statNotifications**
   * [GET /statNotifications/](#get-statNotifications)
   * [POST /statNotifications/](#post-statNotifications)
   * [DELETE /statNotifications/](#delete-statNotifications)
* **entryNotifications**
   * [GET /entryNotifications/](#get-entryNotifications)
   * [POST /entryNotifications/](#post-entryNotifications)
   * [PUT /entryNotifications/](#put-entryNotifications)    
   * [DELETE /entryNotifications/](#delete-entryNotifications)
* **complaints**
   * [POST /complaints/](#post-complaints)

## GET /statAccess/
Возвращает id пользователей, к которым есть доступ или которым дан доступ
#### Параметры
*  ```type``` *(обязательно)* - Если указано значение ```fromId```, запрос вернет VK ID пользователей, которые дали юзеру доступ. Если указано значение ```toId```, запрос вернет VK ID пользователей, которым юзер дал доступ на чтение своей статистики.
#### Ответ
Массив объектов - id юзера и дата создания пары доступа. Объекты отсортированы в порядке убывания даты.
#### Пример
```json
[
    {
        "id": 230944995,
        "date": "2020-07-22 13:39:29"
    },
    {
        "id": 368889050,
        "date": "2020-07-21 10:30:20"
    },
    {
        "id": 505643430,
        "date": "2020-07-16 19:54:00"
    }
]
```

## POST /statAccess/
Создает новую пару доступа.
#### Параметры
*  ```toId``` *(обязательно)* - VK ID пользователей, котрым нужно дать доступ, через запятую
#### Ответ
В случае успеха вернет кол-во созданных пар

## DELETE /statAccess/
Удаляет пару доступа.
#### Параметры
*  ```toId``` *(обязательно)* - VK ID пользователей, котрым нужно запретить доступ, через запятую
#### Ответ
В случае успеха вернет пустой ответ

## GET /entries/
Возвращает записи пользователей в порядке убывания ```entryId``` (в порядке создания, т.е. чем больше ```entryId```, тем позже создана запись).
#### Параметры
* ```users``` - VK ID пользователей через запятую. Если не указано, вернутся все доступные посты, т.е. свои и друзей.
* ```day``` - День по UTC в формате YYYY-MM-DD
* ```month``` - Месяц по UTC в формате YYYY-MM
* ```lastId``` - ID записи, до которой надо выбрать строки, т.е. вернутся поля с ```entryId < lastId```
* ```lastDate``` - Дата по UTC в формате YYYY-MM-DD HH:MM:SS, до которой надо выбрать строки, т.е. вернутся поля с ```date < lastDate```
* ```count``` - Сколько записей вернуть
#### Примечание
* Если указаны параметры  ```day``` и  ```month``` одновременно, то учитываться будет только  ```day```
#### Ответ
Объект с полями в виде VK ID юзеров. Ключ поля - массив объектов с параметрами:
* ```entryId``` - ID записи
* ```userId``` - VK ID автора записи
* ```mood``` - Настроение от 1 до 5
* ```stress``` - Стресс от 1 до 5
* ```anxiety``` - Тревожность от 1 до 5
* ```title``` - Заголовок записи, максимум 64 символа
* ```note``` - Текст записи, максимум 2048 символов
* ```isPublic``` - Доступно ли друзьям, 1 или 0
* ```date``` - Дата по UTC в формате YYYY-MM-DD HH:MM:SS
#### Пример
```json
[
    {
        "entryId": 1066,
        "userId": 331480448,
        "mood": 2,
        "stress": 3,
        "anxiety": 4,
        "title": "fir",
        "note": "",
        "isPublic": 0,
        "date": "2020-06-19 12:34:56"
    },
    {
        "entryId": 904,
        "userId": 505643430,
        "mood": 5,
        "stress": 1,
        "anxiety": 1,
        "title": "День норм",
        "note": "",
        "isPublic": 1,
        "date": "2020-06-16 12:05:24"
    }
]
```

## GET /entries/stats
Возвращает статистику пользователей в порядке убывания даты. Используйте вместо ```GET /entries/```, чтобы избежать утечки приватных данных. Т.к. в возвращаемых данных нет полей с записями, статы могут браться даже из приватных записей.
#### Параметры
*  ```users``` - VK ID пользователей через запятую. Если не указано, вернутся все доступные статы, т.е. свои и друзей.
* ```startDate``` - Дата по UTC в формате YYYY-MM-DD после которой необходимо выбрать записи. Если параметр не указан, вернутся все записи.
#### Ответ
Также, как и в ```GET /entries/```, но без полей ```title```,```note``` и ```isPublic```. Есть группировка записей по VK ID.
#### Пример
```json
{
    "331480448": [
        {
            "entryId": 1068,
            "mood": 2,
            "stress": 3,
            "anxiety": 4,
            "date": "2020-06-19 12:34:56"
        }
    ],
    "505643430": [
        {
            "entryId": 904,
            "mood": 5,
            "stress": 1,
            "anxiety": 1,
            "date": "2020-06-16 12:05:24"
        }
    ]
}
```

## POST /entries/
Создает новую запись пользователя и возвращает ID последней добавленной записи
#### Параметры
* ```entries``` *(обязательно)* - JSON объект с записями. В каждом объекте должны быть следующие параметры:
    * ```mood``` *(обязательно)* - Настоение пользователя от 1 до 5
    * ```stress``` *(обязательно)* - Стресс пользователя от 1 до 5
    * ```anxiety``` *(обязательно)* - Тревожность пользователя от 1 до 5
    * ```isPublic``` - Доступна ли запись друзьям, 1 или 0. По умолчанию 0.
    * ```title``` - Заголовок записи, строка с максимальной длиной в 64 символа. По умолчанию пустая строка.
    * ```note``` - Текст записи, строка с максимальной длиной в 2048 символов. По умолчанию пустая строка.
    * ```date``` - Дата по UTC в формате YYYY-MM-DD HH:MM:SS. По умолчанию текущее время.
#### Примечание
* Все параметры кроме ```title``` и ```note``` имеют автоисправление. Т.е. настроение меньше единицы будет заменено на 1, а больше пятерки - на 5. Аналогично с ```isPublic```. Если дата больше текущей по UTC, то она заменяется на нее.
#### Пример
```json
[
  {
      "mood": 5,
      "stress": -5,
      "anxiety": 5,
      "note": "bla bla bla"
  },
  {
      "mood": 1,
      "stress": 100,
      "anxiety": 1,
      "title": "title",
      "isPublic": 100,
      "date": "3333-06-20",
  }
]
```
#### Ответ
В случае успеха вернет ID последней добавленной записи

## PUT /entries/
Редактирует запись пользователя
#### Параметры
* ```entryId``` *(обязательно)* - ID записи
* ```mood``` - Настоение пользователя от 1 до 5
* ```stress``` - Стресс пользователя от 1 до 5
* ```anxiety``` - Тревожность пользователя от 1 до 5
* ```isPublic``` - Доступна ли запись друзьям, 1 или 0
* ```title``` - Заголовок записи, строка с максимальной длиной в 64 символа
* ```note``` - Текст записи, строка с максимальной длиной а 2048 символов
#### Примечание
* Все параметры кроме ```title``` и ```note``` имеют автоисправление. Т.е. настроение меньше единицы будет заменено на 1, а больше пятерки - на 5. Аналогично с ```isPublic```.
#### Ответ
В случае успеха вернет пустой ответ

## DELETE /entries/
Удаляет запись пользователя
#### Параметры
* ```entryId``` *(обязательно)* - ID записи
#### Ответ
В случае успеха вернет пустой ответ

## GET /statNotifications/
Показывает, подписан ли юзер на уведомления о плохом самочувствии друзей
#### Параметры
Нет
#### Ответ
```true``` или ```false``` в случае успеха.

## POST /statNotifications/
Подписывает юзера на уведомления о плохом самочувствии друзей
#### Параметры
Нет
#### Ответ
В случае успеха вернет кол-во затронутых строк.

## DELETE /statNotifications/
Отписывает юзера от уведомлений о плохом самочувствии друзей
#### Параметры
Нет
#### Ответ
В случае успеха вернет пустой ответ

## GET /entryNotifications/
Показывает, подписан ли юзер на напоминания о создании записи
#### Параметры
Нет
#### Ответ
В случае успеха вернет строку - время по UTC, в которое должны приходит уведомления. Если юзер не подписан - вернется пустой ответ.
#### Пример
```json
"23:00:00"
```

## POST /entryNotifications/
Подписывает юзера на напоминания о создании записи
#### Параметры
* ```time``` *(обязательно)* - Время по UTC в формате HH:MM, в которое должны приходить напоминания
#### Ответ
В случае успеха вернет кол-во затронутых строк

## PUT /entryNotifications/
Меняет время напоминаний
#### Параметры
* ```time``` *(обязательно)* - Время по UTC в формате HH:MM, в которое должны приходить напоминания
#### Ответ
В случае успеха вернет пустой ответ

## DELETE /entryNotifications/
Отписывает юзера от напоминаний о создании записи
#### Параметры
Нет
#### Ответ
В случае успеха вернет пустой ответ

## POST /complaints/
Создает жалобу пользователя на запись. Повторные жалобы не учитываются
#### Параметры
* ```entryId``` *(обязательно)* - ID записи
#### Ответ
В случае успеха вернет пустой ответ
